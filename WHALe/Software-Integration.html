<!DOCTYPE html>
<html style="font-size: 16px;">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="The beauty of nature, the sky, the mountain, the tree..., Unseen beauty, 9 Things You Can Do to Save the Environment, 1, 2, 3, 4, 5, 6, Current projects, Save The World!, Save The World!">
    <meta name="description" content="">
    <meta name="page_type" content="np-template-header-footer-from-plugin">
    <title>Software Integration</title>
    <link rel="stylesheet" href="nicepage.css" media="screen">
<link rel="stylesheet" href="Software-Integration.css" media="screen">
    <script class="u-script" type="text/javascript" src="jquery-1.9.1.min.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="nicepage.js" defer=""></script>
    <meta name="generator" content="Nicepage 4.1.7, nicepage.com">
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,400,400i,700,700i,900,900i|Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i">
    <link id="u-page-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Playfair+Display:400,400i,500,500i,600,600i,700,700i,800,800i,900,900i">
    
    
    
    
    
    
    
    <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": "piefinal",
		"logo": "images/default-logo.png",
		"sameAs": [
				"https://github.com/ahuitric/PIEFinalProject"
		]
}</script>
    <meta name="theme-color" content="#81c132">
    <meta property="og:title" content="Software Integration">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
  </head>
  <body class="u-body"><header class="u-align-right u-clearfix u-grey-5 u-header u-sticky u-sticky-347d u-header" id="sec-5d34"><div class="u-clearfix u-sheet u-sheet-1">
        <a href="https://nicepage.com" class="u-image u-logo u-image-1">
          <img src="images/default-logo.png" class="u-logo-image u-logo-image-1">
        </a>
        <nav class="u-menu u-menu-dropdown u-offcanvas u-menu-1">
          <div class="menu-collapse" style="font-size: 1rem; letter-spacing: 0px;">
            <a class="u-button-style u-custom-left-right-menu-spacing u-custom-padding-bottom u-custom-top-bottom-menu-spacing u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="#">
              <svg viewBox="0 0 24 24"><use xlink:href="#menu-hamburger"></use></svg>
              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><symbol id="menu-hamburger" viewBox="0 0 16 16" style="width: 16px; height: 16px;"><rect y="1" width="16" height="2"></rect><rect y="7" width="16" height="2"></rect><rect y="13" width="16" height="2"></rect>
</symbol>
</defs></svg>
            </a>
          </div>
          <div class="u-nav-container">
            <ul class="u-custom-font u-heading-font u-nav u-spacing-25 u-unstyled u-nav-1"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Home-Page.html" style="padding: 8px 0px;">Home Page</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Electrical-Integration.html" style="padding: 8px 0px;">Electrical Integration</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Mechanical-Integration.html" style="padding: 8px 0px;">Mechanical Integration</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Software-Integration.html" style="padding: 8px 0px;">Software Integration</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Bill-of-Materials.html" style="padding: 8px 0px;">Bill of Materials</a>
</li></ul>
          </div>
          <div class="u-nav-container-collapse">
            <div class="u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav">
              <div class="u-inner-container-layout u-sidenav-overflow">
                <div class="u-menu-close"></div>
                <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-2"><li class="u-nav-item"><a class="u-btn-text u-button-style u-nav-link" href="Home-Page.html" style="padding: 8px 0px;">Home Page</a>
</li><li class="u-nav-item"><a class="u-btn-text u-button-style u-nav-link" href="Electrical-Integration.html" style="padding: 8px 0px;">Electrical Integration</a>
</li><li class="u-nav-item"><a class="u-btn-text u-button-style u-nav-link" href="Mechanical-Integration.html" style="padding: 8px 0px;">Mechanical Integration</a>
</li><li class="u-nav-item"><a class="u-btn-text u-button-style u-nav-link" href="Software-Integration.html" style="padding: 8px 0px;">Software Integration</a>
</li><li class="u-nav-item"><a class="u-btn-text u-button-style u-nav-link" href="Bill-of-Materials.html" style="padding: 8px 0px;">Bill of Materials</a>
</li></ul>
              </div>
            </div>
            <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
          </div>
        </nav>
      </div></header> 
    <section class="u-clearfix u-image u-shading u-section-1" id="sec-eca5" data-image-width="487" data-image-height="1080">
      <div class="u-clearfix u-sheet u-sheet-1">
        <div class="u-container-style u-expanded-width-sm u-expanded-width-xs u-group u-opacity u-opacity-15 u-palette-5-base u-group-1">
          <div class="u-container-layout u-container-layout-1">
            <div class="u-border-3 u-border-white u-shape u-shape-bottom u-shape-left u-shape-1"></div>
            <h1 class="u-align-center u-text u-text-body-alt-color u-title u-text-1">Software Subsystem<br>
            </h1>
            <div class="u-border-3 u-border-white u-shape u-shape-right u-shape-top u-shape-2"></div>
          </div>
        </div>
      </div>
    </section>
    <section class="u-clearfix u-image u-section-2" id="sec-2668">
      <div class="u-clearfix u-sheet u-sheet-1">
        <div class="u-align-center-lg u-align-center-md u-align-center-sm u-align-center-xl u-container-style u-expanded-width-md u-expanded-width-sm u-expanded-width-xs u-group u-group-1">
          <div class="u-container-layout u-valign-middle u-container-layout-1">
            <h2 class="u-align-center-xs u-text u-text-1">Design Overview</h2>
            <div class="u-border-2 u-border-palette-1-base u-line u-line-horizontal u-line-1"></div>
            <p class="u-align-center-xs u-text u-text-2"> The software in this project uses the Deepface library to recognize a user’s dominant emotion through a live webcam feed which then is used to control an Arduino’s servo output to play music.</p>
          </div>
        </div>
        <div class="u-align-left u-container-style u-expanded-width u-group u-group-2">
          <div class="u-container-layout u-container-layout-2">
            <h3 class="u-text u-text-3">High Level Software</h3>
            <h6 class="u-text u-text-4">System Diagram<br>
            </h6>
            <img class="u-image u-image-round u-opacity u-opacity-85 u-radius-5 u-image-1" src="images/PIEsystemsoverviewtransparent.png" alt="" data-image-width="1033" data-image-height="1034">
            <h5 class="u-text u-text-5">Face and Emotion Recognition<br>
            </h5>
            <p class="u-text u-text-6"> &nbsp;&nbsp;&nbsp; &nbsp;<span style="font-size: 1.25rem;">&nbsp;&nbsp; Taking the live captures from the web camera the facial recognition part of the code is for rapid debugging and user interaction more so than functionality as the emotion recognition is able to work independently of the former. Currently, facial recognition identifies the region where a face is recognized and using OpenCV a yellow square is drawn around it, however there is also an option coded in to crop the image to just show the face if the user prefers. In order to identify emotions, the DeepFace library is used. Then with the same live captures, the DeepFace code runs a best estimate for several different parameters including gender, race, age, and emotions. Our variable of interest is ‘dominant_emotion’ which is the highest ranking emotion found in the capture. There are seven different possible emotions which are then converted for use in the Arduino.</span>
            </p>
            <h5 class="u-text u-text-7"> Interfacing Between Laptop and Arduino</h5>
            <p class="u-text u-text-8">
              <span style="font-size: 1.25rem;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; The dominant emotion found from the python code is then converted to a number 1-7 that can be transmitted over serial to the Arduino that controls the servos. The python code will only display an image when its dominant emotion is sent to the Arduino. The Arduino is not always checking the serial data it receives so the code running on the PC will only send serial information when it reads the Arduino serial message ‘Seeking’ which means the Arduino is in the state to receive information.</span>
            </p>
            <h5 class="u-text u-text-9"> Servo Operation from Arduino</h5>
            <p class="u-text u-text-10">
              <span style="font-size: 1.25rem;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; The Arduino runs a fairly simple finite state machine that only goes between two states: when it is seeking a serial message from the PC and when it is playing music. Additionally, to control so many servos, an additional PCA9685 Adafruit PWM servo driver is wired up to the Arduino. So when the Arduino starts up it sets up all the servos and zeros them. Then it moves to state one of the FSM and serial writes ‘Seeking’ so that the python code running on the PC will start sending it an emotion number. Once the Arduino serial reads a number sent from the PC it will move to State two where it starts playing a hard-coded song representing one of the seven different emotions. Since the music box had several missing notes, the notes the servos control are only for the C major scale in the range C4 to C6. Therefore some of the songs have creative ‘reinterpretations’ to make up for the missing flats and sharps. The songs were hard coded using a ‘play_note’ method that would take in the note name representing the servo as well as the length of the note thus the note would be struck by turning the servo then zeroing it after a constant delay following by an additional delay to make up the length of the note.</span>
            </p>
          </div>
        </div>
      </div>
    </section>
    <section class="u-align-left u-clearfix u-grey-5 u-section-3" id="sec-582c">
      <div class="u-clearfix u-sheet u-valign-middle u-sheet-1">
        <div class="fr-view u-align-left u-clearfix u-rich-text u-text u-text-1">
          <h2 style="text-align: left;">Firmware</h2>
          <p id="isPasted">
            <span style="font-size: 1.25rem;">The firmware written for this project can be found in our GitHub repository. Below is a list of the files found in the repository and their functions:</span>
          </p>
          <ul>
            <li dir="ltr" style="font-size: 1.25rem;">
              <p>haarcascade_frontalface_alt.xml - a popular predefined haar cascade file that contains the data for the frontal view of a face in order to set the OpenCV cascade classifier.</p>
            </li>
            <li dir="ltr" style="font-size: 1.25rem;">
              <p>laptopcam.py - &nbsp;the main python code that is run on a Windows 10 laptop with a web camera to do facial recognition with the above file as well as the DeepFace Library to send the live emotions of a user to the Arduino that controls the music box servos.</p>
            </li>
            <li dir="ltr" style="font-size: 1.25rem;">
              <p>music_box.ino - the main Arduino code that receives serial data from the laptop and controls the music box servos with several hard coded songs.</p>
            </li>
            <li dir="ltr" style="font-size: 1.25rem;">
              <p>music_motor.ino - a simple file that runs on the second Arduino to spin the motor that rotates the music box gears.</p>
            </li>
          </ul>
          <p style="text-align: left;">
            <span style="line-height: 2.0;">&nbsp;</span>
          </p>
        </div>
      </div>
    </section>
    <section class="u-align-left u-clearfix u-palette-3-light-2 u-section-4" id="carousel_c86f">
      <div class="u-clearfix u-sheet u-valign-middle u-sheet-1">
        <div class="fr-view u-align-right u-clearfix u-rich-text u-text u-text-1">
          <h2 style="text-align: right;">Past Iterations</h2>
          <p>&nbsp; &nbsp; &nbsp; <span style="font-size: 1.25rem;">&nbsp; The first two sprints of this project had entirely different sets of code as the programming side of this project was originally using only using IR sensors and driving two motors. However this shifted into attempts to use a Raspberry pi with OpenCV to do color masking however setting up dependencies and communicating between the pi and Arduino proved to be a challenge when we had not even begun to work on writing songs into them. During the second sprint there was some consideration for using MIDI files but after several iterations of trying to dissect it in python or slicing up the MIDI with Mido to send in serial, it was proving too complicated to be achieved in the short time period, especially on an Arduino that was already going to be running 15 servos. Thus we scoped down to the current project as outlined above.</span>
          </p>
        </div>
      </div>
    </section>
    <section class="u-clearfix u-image u-shading u-section-5" id="sec-0ced">
      <div class="u-clearfix u-sheet u-valign-middle u-sheet-1">
        <div class="u-clearfix u-expanded-width u-layout-wrap u-layout-wrap-1">
          <div class="u-layout">
            <div class="u-layout-row">
              <div class="u-container-style u-layout-cell u-left-cell u-size-60 u-layout-cell-1">
                <div class="u-container-layout u-valign-bottom u-container-layout-1">
                  <h2 class="u-custom-font u-font-playfair-display u-text u-text-black u-text-1">Operation<br>
                  </h2>
                  <div class="u-border-6 u-border-grey-dark-1 u-line u-line-horizontal u-line-1"></div>
                  <br>
                  <br>
                  <br>
                  <br>
                  <br>
                  <br>
                  <h6 class="u-text u-text-body-color u-text-2"> To run this project the following steps must be completed:</h6>
                  <ol class="u-text u-text-body-color u-text-3">
                    <li>
                      <span style="font-size: 1.25rem;">Dependencies/libraries for python and arduino code installed (see below)</span>
                    </li>
                    <li>
                      <span style="font-size: 1.25rem;">Arduino for controlling the motor that spins the music box gears needs the motor code uploaded and connected to a power supply as it will not be drawing power from the PC</span>
                    </li>
                    <li>
                      <span style="font-size: 1.25rem;">Arduino for controlling the servos needs to be connected by USBC-A cable for powering and serial data transmission</span>
                    </li>
                    <li>
                      <span style="font-size: 1.25rem;">Serial monitor must be closed</span>
                    </li>
                    <li>
                      <span style="font-size: 1.25rem;">Correct COMPORT for the latter arduino must be edited in laptopcam.py and music_box.ino</span>
                    </li>
                    <li>
                      <span style="font-size: 1.25rem;">Upload and run the code for the servo arduino (music_box.ino) and zero servos if necessary</span>
                    </li>
                    <li>
                      <span style="font-size: 1.25rem;">Run the python code with the haarcascade data in the same folder and wait a few seconds for the DeepFace library to start making calculations (there will be output in the terminal)</span>
                    </li>
                    <li>
                      <span style="font-size: 1.25rem;">When an image capture pops up on the screen, the python code is sending the emotion displayed for that image to the servo arduino which should start playing notes</span>
                    </li>
                  </ol>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="u-clearfix u-grey-5 u-section-6" id="sec-42e9">
      <div class="u-clearfix u-sheet u-sheet-1">
        <h3 class="u-text u-text-1">Dependencies</h3>
        <p class="u-text u-text-2"> &nbsp;<span style="font-size: 1.25rem;">&nbsp;&nbsp; This project uses a Windows 10 computer with a webcam and an Arduino Uno that is plugged into the laptop with a USB-USBA cable. The Arduino is connected to a PCA9685 (library&nbsp;<a href="https://learn.adafruit.com/16-channel-pwm-servo-driver/using-the-adafruit-library" class="u-active-none u-border-none u-btn u-button-style u-hover-none u-none u-text-palette-1-base u-btn-1"> here</a>) Adafruit PWM servo driver as fifteen servos are used to play notes on a music box. Note: Serial monitor cannot be open at the same time as running the python code.Currently the code and its dependencies work on Windows 10, the following things will need to be installed:
          </span>
        </p>
        <div class="u-border-3 u-border-palette-1-base u-container-style u-expanded-width u-group u-palette-1-light-2 u-group-1">
          <div class="u-container-layout u-container-layout-1">
            <p class="u-custom-font u-font-courier-new u-text u-text-default u-text-3"> pip install opencvpip <br>install opencv-contrib-python<br>pip install numpy<br>pip install deepface
            </p>
          </div>
        </div>
      </div>
    </section>
    
    
    <footer class="u-clearfix u-footer u-palette-2-dark-3" id="sec-434c"><div class="u-clearfix u-sheet u-sheet-1">
        <div class="u-border-1 u-border-white u-expanded-width u-line u-line-horizontal u-opacity u-opacity-50 u-line-1"></div>
        <div class="u-align-left u-social-icons u-spacing-10 u-social-icons-1">
          <a class="u-social-url" target="_blank" data-type="Github" title="Our Github" href="https://github.com/ahuitric/PIEFinalProject"><span class="u-icon u-social-github u-social-icon u-icon-1"><svg class="u-svg-link" preserveAspectRatio="xMidYMin slice" viewBox="0 0 32 32" style=""><use xlink:href="#svg-bb88"></use></svg><svg class="u-svg-content" viewBox="0 0 32 32" id="svg-bb88"><path clip-rule="evenodd" d="M16.003,0C7.17,0,0.008,7.162,0.008,15.997  c0,7.067,4.582,13.063,10.94,15.179c0.8,0.146,1.052-0.328,1.052-0.752c0-0.38,0.008-1.442,0-2.777  c-4.449,0.967-5.371-2.107-5.371-2.107c-0.727-1.848-1.775-2.34-1.775-2.34c-1.452-0.992,0.109-0.973,0.109-0.973  c1.605,0.113,2.451,1.649,2.451,1.649c1.427,2.443,3.743,1.737,4.654,1.329c0.146-1.034,0.56-1.739,1.017-2.139  c-3.552-0.404-7.286-1.776-7.286-7.906c0-1.747,0.623-3.174,1.646-4.292C7.28,10.464,6.73,8.837,7.602,6.634  c0,0,1.343-0.43,4.398,1.641c1.276-0.355,2.645-0.532,4.005-0.538c1.359,0.006,2.727,0.183,4.005,0.538  c3.055-2.07,4.396-1.641,4.396-1.641c0.872,2.203,0.323,3.83,0.159,4.234c1.023,1.118,1.644,2.545,1.644,4.292  c0,6.146-3.74,7.498-7.304,7.893C19.479,23.548,20,24.508,20,26c0,2,0,3.902,0,4.428c0,0.428,0.258,0.901,1.07,0.746  C27.422,29.055,32,23.062,32,15.997C32,7.162,24.838,0,16.003,0z" fill="currentColor" fill-rule="evenodd"></path></svg></span>
          </a>
        </div>
      </div></footer>
    <section class="u-backlink u-clearfix u-grey-80">
      <a class="u-link" href="https://nicepage.com/website-design" target="_blank">
        <span>Website Design Ideas</span>
      </a>
      <p class="u-text">
        <span>created with</span>
      </p>
      <a class="u-link" href="https://nicepage.com/wysiwyg-html-editor" target="_blank">
        <span>WYSIWYG HTML Editor</span>
      </a>. 
    </section>
  </body>
</html>